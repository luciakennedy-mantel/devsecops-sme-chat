<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevSecOps Documentation Chat</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
            background: #0d1117;
            color: #e6edf3;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e6edf3;
            padding: 1.5rem;
            text-align: center;
            border-bottom: 1px solid #30363d;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #58a6ff, #79c0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .robot-icon {
            font-size: 2rem;
            animation: robotBounce 2s ease-in-out infinite;
        }

        @keyframes robotBounce {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            25% { transform: translateY(-5px) rotate(-2deg); }
            50% { transform: translateY(0px) rotate(0deg); }
            75% { transform: translateY(-3px) rotate(2deg); }
        }

        .header p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
            background: #161b22;
            border-left: 1px solid #30363d;
            border-right: 1px solid #30363d;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            background: #0d1117;
        }

        .messages::-webkit-scrollbar {
            width: 8px;
        }

        .messages::-webkit-scrollbar-track {
            background: #161b22;
        }

        .messages::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        .messages::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        .message {
            margin-bottom: 1.5rem;
            padding: 1rem 1.25rem;
            border-radius: 12px;
            max-width: 85%;
            line-height: 1.6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .message.user {
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
            margin-left: auto;
            text-align: right;
            border: 1px solid #2ea043;
        }

        .message.assistant {
            background: #21262d;
            border: 1px solid #30363d;
            margin-right: auto;
            color: #e6edf3;
        }

        .message.assistant strong {
            color: #58a6ff;
        }

        .message.assistant ul {
            margin: 0.75rem 0;
            padding-left: 1.5rem;
        }

        .message.assistant li {
            margin: 0.5rem 0;
            color: #c9d1d9;
        }

        .input-container {
            padding: 1.5rem;
            background: #161b22;
            border-top: 1px solid #30363d;
        }

        .input-form {
            display: flex;
            gap: 0.75rem;
            align-items: flex-end;
        }

        .message-input {
            flex: 1;
            padding: 0.875rem 1rem;
            background: #0d1117;
            border: 2px solid #30363d;
            border-radius: 8px;
            font-size: 16px;
            color: #e6edf3;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .message-input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .message-input::placeholder {
            color: #7d8590;
        }

        .send-btn {
            padding: 0.875rem 1.5rem;
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .send-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #2ea043, #238636);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .send-btn:disabled {
            background: #30363d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .typing {
            font-style: italic;
            color: #7d8590;
            padding: 1rem;
            text-align: center;
            background: #161b22;
            border-radius: 8px;
            margin: 0 1.5rem;
        }

        .suggestions {
            padding: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            background: #161b22;
            border-top: 1px solid #30363d;
        }

        .suggestion {
            padding: 0.75rem 1.25rem;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            color: #e6edf3;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .suggestion:hover {
            background: #30363d;
            border-color: #58a6ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .chat-container {
                margin: 0;
                border-left: none;
                border-right: none;
            }
            
            .header {
                padding: 1rem;
            }
            
            .messages {
                padding: 1rem;
            }
            
            .input-container {
                padding: 1rem;
            }
            
            .suggestions {
                padding: 1rem;
            }
            
            .message {
                max-width: 95%;
                padding: 0.875rem 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span class="robot-icon">ü§ñ</span>
            DevSecOps Documentation Assistant
            <span class="robot-icon">üõ°Ô∏è</span>
        </h1>
        <p>Ask me about CUJs, SLIs, SLOs, Observability, and DevSecOps best practices</p>
    </div>

    <div class="chat-container">
        <div class="messages" id="messages">
            <div class="message assistant">
                <strong>Welcome!</strong> I'm your DevSecOps documentation assistant. I can help you with:
                <ul style="margin-top: 0.5rem;">
                    <li>Critical User Journeys (CUJs)</li>
                    <li>Service Level Indicators (SLIs) and Objectives (SLOs)</li>
                    <li>Observability and monitoring strategies</li>
                    <li>DevSecOps best practices</li>
                    <li>CBA framework guidance</li>
                </ul>
            </div>
        </div>

        <div class="suggestions">
            <button class="suggestion" onclick="sendMessage('What is a Critical User Journey?')">What is a CUJ?</button>
            <button class="suggestion" onclick="sendMessage('How do I create SLIs for my service?')">How to create SLIs?</button>
            <button class="suggestion" onclick="sendMessage('Show me observability maturity levels')">Observability Maturity</button>
            <button class="suggestion" onclick="sendMessage('What are DevSecOps best practices?')">Best Practices</button>
        </div>

        <div class="typing" id="typing" style="display: none;">
            Assistant is typing...
        </div>

        <div class="input-container">
            <form class="input-form" id="messageForm">
                <input 
                    type="text" 
                    class="message-input" 
                    id="messageInput" 
                    placeholder="Ask me about DevSecOps, CUJs, SLIs, SLOs..."
                    autocomplete="off"
                >
                <button type="submit" class="send-btn" id="sendButton">Send</button>
            </form>
        </div>
    </div>

    <script>
        const socket = io();
        const messagesDiv = document.getElementById('messages');
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingDiv = document.getElementById('typing');

        // Focus input on load
        messageInput.focus();

        // Handle form submission
        messageForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const message = messageInput.value.trim();
            if (message) {
                sendMessage(message);
                messageInput.value = '';
            }
        });

        // Send message function
        function sendMessage(message) {
            // Add user message
            addMessage(message, 'user');
            
            // Show typing indicator
            showTyping();
            
            // Disable input
            setInputEnabled(false);
            
            // Send to server
            socket.emit('chat_message', { message: message });
        }

        // Add message to chat
        function addMessage(content, sender, useTypewriter = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            if (sender === 'assistant' && useTypewriter) {
                // Create empty message and start typewriter effect
                messageDiv.innerHTML = '';
                messagesDiv.appendChild(messageDiv);
                typewriterEffect(messageDiv, formatMessage(content));
            } else {
                messageDiv.innerHTML = formatMessage(content);
                messagesDiv.appendChild(messageDiv);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        }

        // Typewriter effect function
        function typewriterEffect(element, text, speed = 30) {
            let i = 0;
            element.innerHTML = '';
            
            function typeChar() {
                if (i < text.length) {
                    // Handle HTML tags properly
                    if (text.charAt(i) === '<') {
                        let tagEnd = text.indexOf('>', i);
                        if (tagEnd !== -1) {
                            element.innerHTML += text.substring(i, tagEnd + 1);
                            i = tagEnd + 1;
                        } else {
                            element.innerHTML += text.charAt(i);
                            i++;
                        }
                    } else {
                        element.innerHTML += text.charAt(i);
                        i++;
                    }
                    
                    // Auto-scroll as text appears
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    
                    setTimeout(typeChar, speed);
                } else {
                    // Finished typing, re-enable input
                    setInputEnabled(true);
                }
            }
            
            typeChar();
        }

        // Format message content
        function formatMessage(content) {
            // Simple formatting
            return content
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\n/g, '<br>');
        }

        // Show typing indicator
        function showTyping() {
            typingDiv.style.display = 'block';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Hide typing indicator
        function hideTyping() {
            typingDiv.style.display = 'none';
        }

        // Enable/disable input
        function setInputEnabled(enabled) {
            messageInput.disabled = !enabled;
            sendButton.disabled = !enabled;
            if (enabled) {
                messageInput.focus();
            }
        }

        // Socket event handlers
        socket.on('chat_response', function(data) {
            hideTyping();
            addMessage(data.message, 'assistant', true); // Enable typewriter effect
        });

        socket.on('chat_error', function(data) {
            hideTyping();
            addMessage('Error: ' + data.error, 'assistant');
            setInputEnabled(true);
        });

        socket.on('connect', function() {
            console.log('Connected to server');
        });

        socket.on('disconnect', function() {
            console.log('Disconnected from server');
            addMessage('Connection lost. Please refresh the page.', 'assistant');
        });
    </script>
</body>
</html>
